<head>
    <style>
        body {
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <script>

        // canvas variables
        let canvas = document.getElementById("gameCanvas");
        let ctx = canvas.getContext("2d");

        // game variables
        let score = 0;
        let lives = 3;

        // player variables
        let playerX = canvas.width / 2;
        let playerY = canvas.height - 30;
        let playerWidth = 20;
        let playerHeight = 20;
        let playerSpeed = 3;
        let jumping = false;
        let doubleJumping = false;
        let rightPressed = false;
        let leftPressed = false;
        let spacePressed = false;
        let jumpDirection = "up";
        let jumpStartTime = 0;
        let jumpStartY = 0;
        let jumpHeight = 100;
        let gravity = 0.2;



        // obstacle variables
        let obstacles = [];

        setInterval(function () {
            let x = Math.floor(Math.random() * (canvas.width - 20)); // random x position
            let y = -20; // start just off screen
            let width = 20;
            let height = 20;
            let speed = 3; // speed at which the obstacle falls
            obstacles.push({ x, y, width, height, speed });
        }, 1000);


        // item variables
        let items = [];

        setInterval(function () {
            let x = Math.floor(Math.random() * (canvas.width - 20)); // random x position
            let y = -20; // start just off screen
            let width = 20;
            let height = 20;
            let speed = 3; // speed at which the item falls
            let timeout = 3000; // how long the item stays on screen before disappearing
            items.push({ x, y, width, height, speed, timeout });
        }, 1000);


        // handle player movement
        function movePlayer() {
            console.log(`playerY: ${playerY}`);

            // check for left and right arrow keys
            if (rightPressed && playerX < canvas.width - playerWidth) {
                playerX += playerSpeed;
            } else if (leftPressed && playerX > 0) {
                playerX -= playerSpeed;
            }

            // check for spacebar key (jump)
            if (spacePressed && !jumping && !doubleJumping) {
                jumping = true;
                jumpStartY = playerY; // save current y position
                jumpVelocity = -200; // initial jump velocity (in pixels per second)
                jumpStartTime = Date.now(); // set start time for jump
            } else if (spacePressed && jumping && !doubleJumping) {
                doubleJumping = true;
                jumpStartY = playerY; // save current y position
                jumpVelocity = -200; // initial jump velocity (in pixels per second)
                jumpStartTime = Date.now(); // set start time for jump
            }

            // update player y position for jump
            if (jumping || doubleJumping) {
                // calculate elapsed time since jump started
                let elapsedTime = Date.now() - jumpStartTime;

                // calculate player's vertical position using simple physics model
                playerY = jumpStartY + jumpVelocity * elapsedTime / 1000 + 0.5 * gravity * elapsedTime * elapsedTime / 1000000;

                // update jump velocity based on elapsed time
                jumpVelocity += gravity * elapsedTime / 1000;
            }

            // reset jumping and double jumping when player lands on ground
            if (playerY === canvas.height - playerHeight) {
                jumping = false;
                doubleJumping = false;
                jumpDirection = "up";
                jumpVelocity = 0; // reset jump velocity

            }
        }





        // handle obstacle movement and collision with player
        function moveObstacles() {
            for (let i = 0; i < obstacles.length; i++) {
                // move obstacle down screen
                obstacles[i].y += obstacles[i].speed;

                // check for collision with player
                if (
                    playerX < obstacles[i].x + obstacles[i].width &&
                    playerX + playerWidth > obstacles[i].x &&
                    playerY < obstacles[i].y + obstacles[i].height &&
                    playerY + playerHeight > obstacles[i].y
                ) {
                    // remove one life and remove obstacle
                    lives--;
                    obstacles.splice(i, 1);
                }

                // remove obstacle if it goes off screen
                if (obstacles[i].y > canvas.height) {
                    obstacles.splice(i, 1);
                }
            }
        }

        // handle item pickup and collision with player
        function moveItems() {
            for (let i = 0; i < items.length; i++) {
                // decrease timeout
                items[i].timeout -= 20;

                // move item down screen
                items[i].y += items[i].speed;

                // check for collision with player
                if (
                    playerX < items[i].x + items[i].width &&
                    playerX + playerWidth > items[i].x &&
                    playerY < items[i].y + items[i].height &&
                    playerY + playerHeight > items[i].y
                ) {
                    // increase score and remove item
                    score++;
                    items.splice(i, 1);
                }

                // remove item if it goes off screen or timeout has expired
                if (items[i].y > canvas.height || items[i].timeout < 0) {
                    items.splice(i, 1);
                }
            }
        }


        // main game loop
        function gameLoop() {
            // clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // move player, obstacles, and items
            movePlayer();
            moveObstacles();
            moveItems();

            // draw player
            ctx.beginPath();
            ctx.rect(playerX, playerY, playerWidth, playerHeight);
            ctx.fillStyle = "black";
            ctx.fill();
            ctx.closePath();

            // draw obstacles
            for (let i = 0; i < obstacles.length; i++) {
                ctx.beginPath();
                ctx.rect(obstacles[i].x, obstacles[i].y, obstacles[i].width, obstacles[i].height);
                ctx.fillStyle = "red";
                ctx.fill();
                ctx.closePath();
            }

            // draw items
            for (let i = 0; i < items.length; i++) {
                ctx.beginPath();
                ctx.rect(items[i].x, items[i].y, items[i].width, items[i].height);
                ctx.fillStyle = "green";
                ctx.fill();
                ctx.closePath();
            }

            // update score and lives
            ctx.font = "16px Arial";
            ctx.fillStyle = "black";
            ctx.fillText("Score: " + score, 8, 20);
            ctx.fillText("Lives: " + lives, canvas.width - 65, 20);

            // game over
            if (lives === 0) {
                alert("GAME OVER");
                document.location.reload();
            }

            // request new frame
            requestAnimationFrame(gameLoop);
        }

        // add event listeners to handle player movement
        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        // handle key down events
        function keyDownHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = true;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = true;
            } else if (e.key === " ") {
                spacePressed = true;
            }
        }

        // handle key up events
        function keyUpHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = false;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = false;
            } else if (e.key === " ") {
                spacePressed = false;
            }
        }

        // start game loop
        gameLoop();


    </script>

</body>

</html>